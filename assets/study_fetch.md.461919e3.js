import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.82820f36.js";const B=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"study/fetch.md","filePath":"study/fetch.md","lastUpdated":1720542673000}'),p={name:"study/fetch.md"},o=l(`<h2 id="fetch" tabindex="-1">Fetch <a class="header-anchor" href="#fetch" aria-label="Permalink to &quot;Fetch&quot;">​</a></h2><h2 id="abort" tabindex="-1"><strong>abort</strong> <a class="header-anchor" href="#abort" aria-label="Permalink to &quot;**abort**&quot;">​</a></h2><p>由于Promise的限制, fetch 并不支持原生的abort机制, 但这并不妨碍我们使用 Promise.race() 实现一个.</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#DBD7CAEE;">romise.race(iterable) 方法返回一个Promise对象</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> 只要 iterable 中任意一个Promise 被 resolve 或者 reject 后</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> 外部的Promise 就会以相同的值被 resolve 或者 reject.</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#393A34;">romise.race(iterable) 方法返回一个Promise对象</span><span style="color:#999999;">,</span><span style="color:#393A34;"> 只要 iterable 中任意一个Promise 被 resolve 或者 reject 后</span><span style="color:#999999;">,</span><span style="color:#393A34;"> 外部的Promise 就会以相同的值被 resolve 或者 reject.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>支持性:: 从 chrome33, Firefox29, Safari7.1, Opera20, EdgeHTML12(并非Edge版本) 起, Promise就被完整的支持. Promise.race()也随之可用. 下面我们来看下实现.</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> _fetch = (function(fetch)</span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">function</span><span style="color:#DBD7CAEE;">(</span><span style="color:#B8A965;">url</span><span style="color:#DBD7CAEE;">,</span><span style="color:#B8A965;">options</span><span style="color:#DBD7CAEE;">){</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">var</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;"> = </span><span style="color:#B8A965;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">var</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;">_</span><span style="color:#B8A965;">promise</span><span style="color:#DBD7CAEE;"> = </span><span style="color:#B8A965;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#DBD7CAEE;">((</span><span style="color:#B8A965;">resolve</span><span style="color:#DBD7CAEE;">, </span><span style="color:#B8A965;">reject</span><span style="color:#DBD7CAEE;">)=&gt;{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;"> = () =&gt; {</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">reject</span><span style="color:#DBD7CAEE;">(&#39;</span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;">.&#39;)</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">console</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">info</span><span style="color:#DBD7CAEE;">(&#39;</span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">done</span><span style="color:#DBD7CAEE;">.&#39;)</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    });</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> promise = Promise.race(</span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      fetch(url,options),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      abort_promise</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    promise</span><span style="color:#666666;">.</span><span style="color:#BD976A;">abort</span><span style="color:#DBD7CAEE;"> = abort;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    return promise;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  };</span></span>
<span class="line"><span style="color:#DBD7CAEE;">})(fetch);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">p</span><span style="color:#DBD7CAEE;"> = _fetch(&#39;https://www</span><span style="color:#666666;">.</span><span style="color:#BD976A;">baidu</span><span style="color:#DBD7CAEE;">.com&#39;</span><span style="color:#666666;">,{</span><span style="color:#B8A965;">mode</span><span style="color:#666666;">:</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">no-cors</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">);</span></span>
<span class="line"><span style="color:#4D9375;">p</span><span style="color:#DBD7CAEE;">.then(function(res) </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">console</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">log</span><span style="color:#DBD7CAEE;">(&#39;</span><span style="color:#B8A965;">response</span><span style="color:#666666;">:</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#FDAEB7;font-style:italic;">, res);</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">, function(e) </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">console</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">log</span><span style="color:#DBD7CAEE;">(&#39;</span><span style="color:#B8A965;">error</span><span style="color:#666666;">:</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#FDAEB7;font-style:italic;">, e);</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">);</span></span>
<span class="line"><span style="color:#4D9375;">p</span><span style="color:#DBD7CAEE;">.abort();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">//&quot;abort done.&quot;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">//&quot;error: abort.&quot;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">var</span><span style="color:#393A34;"> _fetch = (function(fetch)</span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">return</span><span style="color:#393A34;"> </span><span style="color:#998418;">function</span><span style="color:#393A34;">(</span><span style="color:#998418;">url</span><span style="color:#393A34;">,</span><span style="color:#998418;">options</span><span style="color:#393A34;">){</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">var</span><span style="color:#393A34;"> </span><span style="color:#998418;">abort</span><span style="color:#393A34;"> = </span><span style="color:#998418;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">var</span><span style="color:#393A34;"> </span><span style="color:#998418;">abort</span><span style="color:#393A34;">_</span><span style="color:#998418;">promise</span><span style="color:#393A34;"> = </span><span style="color:#998418;">new</span><span style="color:#393A34;"> </span><span style="color:#998418;">Promise</span><span style="color:#393A34;">((</span><span style="color:#998418;">resolve</span><span style="color:#393A34;">, </span><span style="color:#998418;">reject</span><span style="color:#393A34;">)=&gt;{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">abort</span><span style="color:#393A34;"> = () =&gt; {</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">reject</span><span style="color:#393A34;">(&#39;</span><span style="color:#998418;">abort</span><span style="color:#393A34;">.&#39;)</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">console</span><span style="color:#393A34;">.</span><span style="color:#998418;">info</span><span style="color:#393A34;">(&#39;</span><span style="color:#998418;">abort</span><span style="color:#393A34;"> </span><span style="color:#998418;">done</span><span style="color:#393A34;">.&#39;)</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span><span style="color:#393A34;">;</span></span>
<span class="line"><span style="color:#393A34;">    });</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">var</span><span style="color:#393A34;"> promise = Promise.race(</span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">      fetch(url,options),</span></span>
<span class="line"><span style="color:#393A34;">      abort_promise</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">]</span><span style="color:#393A34;">);</span></span>
<span class="line"><span style="color:#393A34;">    promise</span><span style="color:#999999;">.</span><span style="color:#B07D48;">abort</span><span style="color:#393A34;"> = abort;</span></span>
<span class="line"><span style="color:#393A34;">    return promise;</span></span>
<span class="line"><span style="color:#393A34;">  };</span></span>
<span class="line"><span style="color:#393A34;">})(fetch);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">var</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">p</span><span style="color:#393A34;"> = _fetch(&#39;https://www</span><span style="color:#999999;">.</span><span style="color:#B07D48;">baidu</span><span style="color:#393A34;">.com&#39;</span><span style="color:#999999;">,{</span><span style="color:#998418;">mode</span><span style="color:#999999;">:</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">no-cors</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">}</span><span style="color:#393A34;">);</span></span>
<span class="line"><span style="color:#1E754F;">p</span><span style="color:#393A34;">.then(function(res) </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">console</span><span style="color:#393A34;">.</span><span style="color:#998418;">log</span><span style="color:#393A34;">(&#39;</span><span style="color:#998418;">response</span><span style="color:#999999;">:</span><span style="color:#B5695999;">&#39;</span><span style="color:#B31D28;font-style:italic;">, res);</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;">, function(e) </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">console</span><span style="color:#393A34;">.</span><span style="color:#998418;">log</span><span style="color:#393A34;">(&#39;</span><span style="color:#998418;">error</span><span style="color:#999999;">:</span><span style="color:#B5695999;">&#39;</span><span style="color:#B31D28;font-style:italic;">, e);</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;">);</span></span>
<span class="line"><span style="color:#1E754F;">p</span><span style="color:#393A34;">.abort();</span></span>
<span class="line"><span style="color:#393A34;">//&quot;abort done.&quot;</span></span>
<span class="line"><span style="color:#393A34;">//&quot;error: abort.&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div>`,6),e=[o];function r(c,t,y,i,A,D){return n(),a("div",null,e)}const b=s(p,[["render",r]]);export{B as __pageData,b as default};
