import{_ as s,o as a,c as l,Q as n}from"./chunks/framework.82820f36.js";const D=JSON.parse('{"title":"CSRF与XSS：Web安全中的两大威胁","description":"","frontmatter":{},"headers":[],"relativePath":"study/csrf_xss.md","filePath":"study/csrf_xss.md","lastUpdated":1739638504000}'),p={name:"study/csrf_xss.md"},o=n(`<h1 id="csrf与xss-web安全中的两大威胁" tabindex="-1">CSRF与XSS：Web安全中的两大威胁 <a class="header-anchor" href="#csrf与xss-web安全中的两大威胁" aria-label="Permalink to &quot;CSRF与XSS：Web安全中的两大威胁&quot;">​</a></h1><p>在现代互联网应用中，网络安全问题始终是一个不可忽视的重要议题。其中，跨站请求伪造（CSRF）和跨站脚本（XSS）是两种最常见的安全漏洞，它们不仅能够窃取用户信息，还可能破坏整个系统的正常运行。本文将深入探讨这两种攻击方式的工作原理、实际案例以及防御方法。</p><h2 id="什么是csrf" tabindex="-1">什么是CSRF？ <a class="header-anchor" href="#什么是csrf" aria-label="Permalink to &quot;什么是CSRF？&quot;">​</a></h2><h3 id="定义" tabindex="-1">定义 <a class="header-anchor" href="#定义" aria-label="Permalink to &quot;定义&quot;">​</a></h3><p>跨站请求伪造（Cross-Site Request Forgery，简称CSRF）是一种网络攻击技术，攻击者通过诱使用户在已认证状态下执行非故意的敏感操作。简单来说，CSRF攻击是利用用户的浏览器向已登录的网站发送恶意请求。</p><h3 id="工作原理" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理" aria-label="Permalink to &quot;工作原理&quot;">​</a></h3><ol><li><p><strong>攻击条件</strong>：</p><ul><li>用户已经通过身份验证（如登录）。</li><li>攻击者能够构造一个合法的请求（如转账、修改密码等）。</li><li>浏览器自动携带用户的身份信息（如Cookie或Session）发送请求。</li></ul></li><li><p><strong>常见场景</strong>：</p><ul><li>攻击者诱使用户点击恶意链接。</li><li>在被攻击网站中嵌入隐藏的iframe或其他代码。</li></ul></li><li><p><strong>示例</strong>： 假设用户已登录银行网站，攻击者构造一个包含转账请求的链接：</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">img</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">https://bank.com/transfer?to=hacker&amp;amount=1000</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">/&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">img</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">https://bank.com/transfer?to=hacker&amp;amount=1000</span><span style="color:#B5695999;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#999999;">/&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>当用户加载页面时，浏览器会自动发送请求，执行转账操作。</p></li></ol><h2 id="什么是xss" tabindex="-1">什么是XSS？ <a class="header-anchor" href="#什么是xss" aria-label="Permalink to &quot;什么是XSS？&quot;">​</a></h2><h3 id="定义-1" tabindex="-1">定义 <a class="header-anchor" href="#定义-1" aria-label="Permalink to &quot;定义&quot;">​</a></h3><p>跨站脚本（Cross-Site Scripting，简称XSS）是一种网络攻击技术，攻击者通过在网页中注入恶意脚本代码，窃取用户信息或破坏网站功能。这些脚本会在用户的浏览器中执行，具有用户的权限。</p><h3 id="工作原理-1" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理-1" aria-label="Permalink to &quot;工作原理&quot;">​</a></h3><ol><li><p><strong>攻击条件</strong>：</p><ul><li>网站未对用户输入进行过滤。</li><li>恶意脚本被嵌入到网页的响应中。</li><li>用户浏览该页面时，脚本在浏览器中执行。</li></ul></li><li><p><strong>常见场景</strong>：</p><ul><li>攻击者通过评论、搜索框或其他表单注入恶意代码。</li><li>脚本窃取用户的Cookie或会话信息。</li></ul></li><li><p><strong>示例</strong>： 攻击者在论坛发表一条带有恶意脚本的评论：</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">script</span><span style="color:#666666;">&gt;</span><span style="color:#80A665;">alert</span><span style="color:#666666;">(</span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">cookie</span><span style="color:#666666;">)&lt;/</span><span style="color:#4D9375;">script</span><span style="color:#666666;">&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">script</span><span style="color:#999999;">&gt;</span><span style="color:#59873A;">alert</span><span style="color:#999999;">(</span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">cookie</span><span style="color:#999999;">)&lt;/</span><span style="color:#1E754F;">script</span><span style="color:#999999;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>当用户查看该评论时，浏览器会弹出窗口显示用户的Cookie信息。</p></li></ol><h2 id="csrf与xss的区别" tabindex="-1">CSRF与XSS的区别 <a class="header-anchor" href="#csrf与xss的区别" aria-label="Permalink to &quot;CSRF与XSS的区别&quot;">​</a></h2><table><thead><tr><th>特性</th><th>CSRF</th><th>XSS</th></tr></thead><tbody><tr><td>攻击目标</td><td>用户的行为</td><td>用户的数据或页面</td></tr><tr><td>请求来源</td><td>恶意网站的请求</td><td>用户浏览器执行脚本</td></tr><tr><td>依赖条件</td><td>用户已认证</td><td>网站未对输入进行过滤</td></tr><tr><td>危害</td><td>修改用户数据、窃取权限</td><td>窃取用户信息、破坏页面功能</td></tr></tbody></table><h2 id="csrf攻击的实际案例" tabindex="-1">CSRF攻击的实际案例 <a class="header-anchor" href="#csrf攻击的实际案例" aria-label="Permalink to &quot;CSRF攻击的实际案例&quot;">​</a></h2><h3 id="案例-银行转账诈骗" tabindex="-1">案例：银行转账诈骗 <a class="header-anchor" href="#案例-银行转账诈骗" aria-label="Permalink to &quot;案例：银行转账诈骗&quot;">​</a></h3><p>攻击者创建一个恶意链接，诱使用户点击。假设用户已登录银行网站：</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">a</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">href</span><span style="color:#666666;">=</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#C98A7D;">https://bank.com/transfer?to=hacker&amp;amount=1000</span><span style="color:#C98A7D99;">&quot;</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">点击领取福利</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">a</span><span style="color:#666666;">&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">a</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">href</span><span style="color:#999999;">=</span><span style="color:#B5695999;">&quot;</span><span style="color:#B56959;">https://bank.com/transfer?to=hacker&amp;amount=1000</span><span style="color:#B5695999;">&quot;</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">点击领取福利</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">a</span><span style="color:#999999;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>当用户点击链接时，浏览器会自动发送转账请求，导致用户的资金被盗。</p><h3 id="防御方法" tabindex="-1">防御方法 <a class="header-anchor" href="#防御方法" aria-label="Permalink to &quot;防御方法&quot;">​</a></h3><ol><li><p><strong>Token验证</strong>：</p><ul><li>网站为每个用户生成一个唯一的Token，并要求敏感操作中包含该Token。</li></ul><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#B8A965;">isset</span><span style="color:#666666;">($</span><span style="color:#BD976A;">_POST</span><span style="color:#666666;">[</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">_token</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">])</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">$</span><span style="color:#BD976A;">_POST</span><span style="color:#666666;">[</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">_token</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">$</span><span style="color:#BD976A;">_SESSION</span><span style="color:#666666;">[</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">token</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">])</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 允许请求</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 拒绝请求</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#998418;">isset</span><span style="color:#999999;">($</span><span style="color:#B07D48;">_POST</span><span style="color:#999999;">[</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">_token</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">])</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#999999;">$</span><span style="color:#B07D48;">_POST</span><span style="color:#999999;">[</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">_token</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">==</span><span style="color:#393A34;"> </span><span style="color:#999999;">$</span><span style="color:#B07D48;">_SESSION</span><span style="color:#999999;">[</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">token</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">])</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 允许请求</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 拒绝请求</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>检查Referer来源</strong>：</p><ul><li>网站验证请求的来源是否为本站。</li></ul><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#B8A965;">strpos</span><span style="color:#666666;">($</span><span style="color:#BD976A;">_SERVER</span><span style="color:#666666;">[</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">HTTP_REFERER</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">],</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">$</span><span style="color:#BD976A;">_SERVER</span><span style="color:#666666;">[</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">SERVER_NAME</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">])</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 拒绝请求</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 允许请求</span></span>
<span class="line"><span style="color:#666666;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#998418;">strpos</span><span style="color:#999999;">($</span><span style="color:#B07D48;">_SERVER</span><span style="color:#999999;">[</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">HTTP_REFERER</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">],</span><span style="color:#393A34;"> </span><span style="color:#999999;">$</span><span style="color:#B07D48;">_SERVER</span><span style="color:#999999;">[</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">SERVER_NAME</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">])</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 拒绝请求</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 允许请求</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>使用CSRF保护工具</strong>：</p><ul><li>如OWASP CSRF Protect，自动检测和阻止恶意请求。</li></ul></li></ol><h2 id="xss攻击的实际案例" tabindex="-1">XSS攻击的实际案例 <a class="header-anchor" href="#xss攻击的实际案例" aria-label="Permalink to &quot;XSS攻击的实际案例&quot;">​</a></h2><h3 id="案例-窃取用户cookie" tabindex="-1">案例：窃取用户Cookie <a class="header-anchor" href="#案例-窃取用户cookie" aria-label="Permalink to &quot;案例：窃取用户Cookie&quot;">​</a></h3><p>攻击者在某个论坛中发表评论：</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">script</span><span style="color:#666666;">&gt;</span><span style="color:#80A665;">alert</span><span style="color:#666666;">(</span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#BD976A;">cookie</span><span style="color:#666666;">)&lt;/</span><span style="color:#4D9375;">script</span><span style="color:#666666;">&gt;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">script</span><span style="color:#999999;">&gt;</span><span style="color:#59873A;">alert</span><span style="color:#999999;">(</span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#B07D48;">cookie</span><span style="color:#999999;">)&lt;/</span><span style="color:#1E754F;">script</span><span style="color:#999999;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>当用户查看该评论时，浏览器会弹出窗口显示用户的Cookie信息，包括登录状态和会话ID。</p><h3 id="防御方法-1" tabindex="-1">防御方法 <a class="header-anchor" href="#防御方法-1" aria-label="Permalink to &quot;防御方法&quot;">​</a></h3><ol><li><p><strong>输入过滤</strong>：</p><ul><li>网站对用户输入进行HTML转义或过滤。</li></ul><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#666666;">$</span><span style="color:#BD976A;">comment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">htmlspecialchars</span><span style="color:#666666;">($</span><span style="color:#BD976A;">_POST</span><span style="color:#666666;">[</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#C98A7D;">comment</span><span style="color:#C98A7D99;">&#39;</span><span style="color:#666666;">],</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">ENT_QUOTES</span><span style="color:#666666;">);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#999999;">$</span><span style="color:#B07D48;">comment</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#998418;">htmlspecialchars</span><span style="color:#999999;">($</span><span style="color:#B07D48;">_POST</span><span style="color:#999999;">[</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">comment</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">],</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">ENT_QUOTES</span><span style="color:#999999;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>使用Content Security Policy（CSP）</strong>：</p><ul><li>限制页面加载外部脚本，防止恶意代码执行。</li></ul><div class="language-http vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">Content-Security-Policy:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">script-src &#39;self&#39;;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">Content-Security-Policy:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">script-src &#39;self&#39;;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>框架验证</strong>：</p><ul><li>使用<code>X-Frame-Options</code>头，防止网页被嵌入到其他网站中。</li></ul><div class="language-http vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">X-Frame-Options:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7D;">DENY;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">X-Frame-Options:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">DENY;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>CSRF和XSS是Web安全中的两大常见威胁，它们分别利用了用户的认证状态和浏览器的执行环境来达到攻击目的。通过采取适当的防御措施（如Token验证、输入过滤和CSP），开发者可以有效降低这些风险。</p>`,30),e=[o];function t(r,c,i,y,d,h){return a(),l("div",null,e)}const m=s(p,[["render",t]]);export{D as __pageData,m as default};
