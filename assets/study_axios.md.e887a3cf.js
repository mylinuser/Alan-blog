import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.82820f36.js";const B=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"study/axios.md","filePath":"study/axios.md","lastUpdated":1720542673000}'),o={name:"study/axios.md"},p=l(`<h2 id="axios" tabindex="-1">Axios <a class="header-anchor" href="#axios" aria-label="Permalink to &quot;Axios&quot;">​</a></h2><h2 id="取消接口请求" tabindex="-1"><strong><strong>取消接口请求</strong></strong> <a class="header-anchor" href="#取消接口请求" aria-label="Permalink to &quot;****取消接口请求****&quot;">​</a></h2><p>Axios 提供了一个 <code>CancelToken</code>的函数，这是一个构造函数，该函数的作用就是用来取消接口请求的。</p><h2 id="xmlhttprequest-取消请求" tabindex="-1"><strong>XMLHttpRequest 取消请求</strong> <a class="header-anchor" href="#xmlhttprequest-取消请求" aria-label="Permalink to &quot;**XMLHttpRequest 取消请求**&quot;">​</a></h2><p>在使用xhr进行异步的请求，是可以进行中止的。</p><p><strong>方法一：xhr.abort() 调用中止api</strong></p><p>xhr 就是 XMLHttpRequest 的实例，该实例调用对应的xhr.abort() 会终止当前的请求。</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> xhr = new XMLHttpRequest();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">xhr.open(&#39;get&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> &#39;https://jianshu.com&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> true);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">xhr.send();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">xhr.onreadystatechange= function ()</span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#B8A965;">console</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">log</span><span style="color:#DBD7CAEE;">(</span><span style="color:#B8A965;">xhr</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">responseText</span><span style="color:#DBD7CAEE;">, &#39;</span><span style="color:#B8A965;">--</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">respone</span><span style="color:#DBD7CAEE;">&#39;)</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">setTimeout(() =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#B8A965;">xhr</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;">()</span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">, 20);</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">var</span><span style="color:#393A34;"> xhr = new XMLHttpRequest();</span></span>
<span class="line"><span style="color:#393A34;">xhr.open(&#39;get&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> &#39;https://jianshu.com&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> true);</span></span>
<span class="line"><span style="color:#393A34;">xhr.send();</span></span>
<span class="line"><span style="color:#393A34;">xhr.onreadystatechange= function ()</span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#998418;">console</span><span style="color:#393A34;">.</span><span style="color:#998418;">log</span><span style="color:#393A34;">(</span><span style="color:#998418;">xhr</span><span style="color:#393A34;">.</span><span style="color:#998418;">responseText</span><span style="color:#393A34;">, &#39;</span><span style="color:#998418;">--</span><span style="color:#393A34;"> </span><span style="color:#998418;">respone</span><span style="color:#393A34;">&#39;)</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">setTimeout(() =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#998418;">xhr</span><span style="color:#393A34;">.</span><span style="color:#998418;">abort</span><span style="color:#393A34;">()</span><span style="color:#999999;">}</span><span style="color:#393A34;">, 20);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>方法二：AbortController</strong></p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki vitesse-dark vp-code-dark"><code><span class="line"><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> controller = new AbortController();</span></span>
<span class="line"><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> signal = controller.signal;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">var</span><span style="color:#DBD7CAEE;"> d = fetch(&#39;www</span><span style="color:#666666;">.</span><span style="color:#BD976A;">jianshu</span><span style="color:#DBD7CAEE;">.com&#39;</span><span style="color:#666666;">,{</span><span style="color:#B8A965;">signal</span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">)</span><span style="color:#666666;font-style:italic;">.</span><span style="color:#FDAEB7;font-style:italic;">then(d</span><span style="color:#DBD7CAEE;"> =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#B8A965;">console</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">log</span><span style="color:#DBD7CAEE;">(</span><span style="color:#B8A965;">d</span><span style="color:#DBD7CAEE;">)</span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">)</span><span style="color:#666666;font-style:italic;">.</span><span style="color:#FDAEB7;font-style:italic;">catch(err</span><span style="color:#DBD7CAEE;"> =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#B8A965;">console</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">log</span><span style="color:#DBD7CAEE;">(</span><span style="color:#B8A965;">err</span><span style="color:#DBD7CAEE;">, &#39;</span><span style="color:#B8A965;">baocuo</span><span style="color:#DBD7CAEE;">...&#39;)</span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">setTimeout(() =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#B8A965;">controller</span><span style="color:#DBD7CAEE;">.</span><span style="color:#B8A965;">abort</span><span style="color:#DBD7CAEE;">()</span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;">, 10);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">// DOMException: The user aborted </span><span style="color:#4D9375;">a</span><span style="color:#DBD7CAEE;"> request. &quot;baocuo..</span><span style="color:#666666;font-style:italic;">.</span><span style="color:#FDAEB7;font-style:italic;">&quot;</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#1E754F;">var</span><span style="color:#393A34;"> controller = new AbortController();</span></span>
<span class="line"><span style="color:#1E754F;">var</span><span style="color:#393A34;"> signal = controller.signal;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">var</span><span style="color:#393A34;"> d = fetch(&#39;www</span><span style="color:#999999;">.</span><span style="color:#B07D48;">jianshu</span><span style="color:#393A34;">.com&#39;</span><span style="color:#999999;">,{</span><span style="color:#998418;">signal</span><span style="color:#999999;">}</span><span style="color:#393A34;">)</span><span style="color:#999999;font-style:italic;">.</span><span style="color:#B31D28;font-style:italic;">then(d</span><span style="color:#393A34;"> =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#998418;">console</span><span style="color:#393A34;">.</span><span style="color:#998418;">log</span><span style="color:#393A34;">(</span><span style="color:#998418;">d</span><span style="color:#393A34;">)</span><span style="color:#999999;">}</span><span style="color:#393A34;">)</span><span style="color:#999999;font-style:italic;">.</span><span style="color:#B31D28;font-style:italic;">catch(err</span><span style="color:#393A34;"> =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#998418;">console</span><span style="color:#393A34;">.</span><span style="color:#998418;">log</span><span style="color:#393A34;">(</span><span style="color:#998418;">err</span><span style="color:#393A34;">, &#39;</span><span style="color:#998418;">baocuo</span><span style="color:#393A34;">...&#39;)</span><span style="color:#999999;">}</span><span style="color:#393A34;">)</span></span>
<span class="line"><span style="color:#393A34;">setTimeout(() =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#998418;">controller</span><span style="color:#393A34;">.</span><span style="color:#998418;">abort</span><span style="color:#393A34;">()</span><span style="color:#999999;">}</span><span style="color:#393A34;">, 10);</span></span>
<span class="line"><span style="color:#393A34;">// DOMException: The user aborted </span><span style="color:#1E754F;">a</span><span style="color:#393A34;"> request. &quot;baocuo..</span><span style="color:#999999;font-style:italic;">.</span><span style="color:#B31D28;font-style:italic;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>方法三：axios.CancelToken</strong></p><p>axios.CancelToken</p><p>axios对abort方法进行了封装，取消请求</p><p>1，axios请求的第二个参数对象中增加一个key，cancelToken，cancelToken是 CancelToken的实例</p><p>2，实例的传参是一个函数，函数的参数是取消请求的方法</p><p>3，将这个方法透传到外层，可以在请求完成之前，随时取消请求。</p>`,16),e=[p];function t(r,c,y,i,A,D){return n(),a("div",null,e)}const d=s(o,[["render",t]]);export{B as __pageData,d as default};
